// データ取得
const selectedTypes = JSON.parse(localStorage.getItem('selectedTypes') || '[]');
const selectedTexts = JSON.parse(localStorage.getItem('selectedTexts') || '[]');
const perspective = localStorage.getItem('perspective') || 'her'; // 'her' or 'his'

// 型の逆変換処理（彼氏視点なら、本音型↔建前型）
const convertedTypes = selectedTypes.map(type => {
  if (perspective === 'his') {
    if (type === "本音型") return "建前型";
    if (type === "建前型") return "本音型";
  }
  return type;
});

// カウント
const countMap = { "本音型": 0, "建前型": 0, "回避型": 0 };
convertedTypes.forEach(type => {
  if (countMap[type] !== undefined) countMap[type]++;
});

// 最終タイプ判定
let finalType = "";
if (countMap["本音型"] >= 2) finalType = "本音型";
else if (countMap["建前型"] >= 2) finalType = "建前型";
else if (countMap["回避型"] >= 2) finalType = "回避型";
else finalType = "バランス型";

// フィードバック定義
const feedbacks = {
  her: {
    "本音型": {
      tameae: "これからもその素直さを大切にしていきましょう。",
      honne: "あなたの素直さは、誰かの優しい嘘をも破壊してしまうかもしれない。"
    },
    "建前型": {
      tameae: "その気づかいが関係を穏やかにしてくれますね。",
      honne: "いつまで本音を飲み込めば、あなたは自分を守れるの？"
    },
    "回避型": {
      tameae: "うまく距離感を保てるのはあなたの長所です。",
      honne: "逃げることで、何も失わずに済むと思ってる？"
    },
    "バランス型": {
      tameae: "状況に合わせて柔軟に振る舞えるあなたは素敵です。",
      honne: "器用すぎるあなたは、本当の気持ちにすら気づかなくなるかもしれない。"
    }
  },
  his: {
    "本音型": {
      tameae: "気持ちをストレートに伝えられるのは大きな魅力です。",
      honne: "その正直さ、相手を黙らせる武器になってない？"
    },
    "建前型": {
      tameae: "そのやさしさがきっと相手を安心させています。",
      honne: "やさしさという名の仮面、外せなくなってない？"
    },
    "回避型": {
      tameae: "無理をしないスタンスはあなたらしさです。",
      honne: "関わらなければ傷つかない。それで本当にいいの？"
    },
    "バランス型": {
      tameae: "場に応じた判断ができる柔軟さがあなたの強みです。",
      honne: "全部わかってる風の顔、本当は何も言えてないだけかもよ？"
    }
  }
  };

  const tameae = feedbacks[perspective][finalType].tameae;
  const honne = feedbacks[perspective][finalType].honne;

  // 本音マップ
const honneMap = {
  her: {
    "すぐ会いたいな〜（笑）": "ほんとはもうずっと我慢してた。声も顔も、今すぐ感じたいの。",
    "最近お互い忙しいし、落ち着いたらでいいよ": "ほんとは今すぐ会いたいけど、重いって思われたくなくて…",
    "また連絡もらえたら嬉しいな": "自分から求めたくない。期待して傷つくくらいなら、待つ方が楽…",
    "久しぶりに遊園地とか行きたいな": "手を繋いで笑って、写真撮って、そんな“恋人らしい日”が欲しいんだ。",
    "近場でゆっくりでもいいかも？": "ほんとは遠出もしたい。でも、君にとって面倒って思われたくないから…",
    "そっちに合わせるよ〜": "自分の希望を伝えるのが怖い。ワガママって思われたくない…",
    "せっかくだしお昼から会おう！": "朝から夜まで、一日中あなたと一緒にいたいの。",
    "無理しなくていいから、ゆっくり会おう": "本音は早く会いたいけど、あなたの都合が優先でしょ？",
    "うーん、その日はちょっとまだわからないかも": "会いたい気持ちより、断られるのが怖くて踏み込めない…"
  },
  his: {
    "〇日なら空いてるけどどう？": "本当はその日も疲れてて会いたくないけど…断るのも気まずいから空いてるふりしてる。",
    "じゃあ月末とかで合わせようか": "できるだけ先延ばしにしたい。正直もう気持ちは冷めてるし、会う意味もない。",
    "とりあえず空いてる日わかったら連絡するわ": "会う気はないけど、断るのも面倒。自然消滅狙いでフェードアウトしよう。",
    "映画とかカフェとか？": "“デートっぽいこと”してればごまかせるかな。でも気持ちは全然乗ってない。",
    "家でまったりでもいいけど": "外出るのも面倒。なんなら会わずに済めば最高。家デートなら寝てるだけで済む。",
    "俺はどこでもいいから、君が行きたいとこでいいよ": "何も決めたくないし、責任も持ちたくない。どうでもいいと思ってる。",
    "昼から合流しよっか": "どうせなら一日付き合って“彼氏っぽいこと”して、うまくやり過ごすか。",
    "夕方からでもいい？": "最低限の時間で済ませたい。少しでも会う時間が短くなれば気が楽。",
    "直前でまた決めよう": "多分ドタキャンすると思う。ギリギリまで様子見て、うまく逃げたい。"
  }
};